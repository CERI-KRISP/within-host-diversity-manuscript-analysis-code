"0","##df of donor recipient pair details"
"0","df_CH3_shared <- data.frame()"
"0","df_CH3_shared_joined <- data.frame()"
"0","## get the shared iSNVs. Note that an iSNV could have progressed to SNV in recipient"
"0","for (row in 1:nrow(df_all_ch3_pairs_sd)) {"
"0","   donorId <- df_all_ch3_pairs[row, ""donor_id""]"
"0","   recipientId <- df_all_ch3_pairs[row, ""recipient_id""]"
"0","   #get donor isnvs and recipient (i)snvs"
"0","   theDonor <- df_isnvs_ch3 %>% filter(Sample == donorId)"
"0","   theRecipient <- df_snvs_isnvs_purged %>% filter(Sample == recipientId)"
"0","   theDonorOId <- df_snvs_isnvs_purged %>% filter(Sample == donorId) %>% {unique(.$outbreak_id)}"
"0","   theRecipientOId <- unique(theRecipient$outbreak_id)"
"0","   ## join the pair"
"0","   pair_001 <- inner_join(theDonor[, c(""Sample"",""POS"",""REF"",""ALT"", ""AF"", ""Mutation"")],"
"0","                        theRecipient[, c(""Sample"",""POS"",""REF"",""ALT"", ""AF"", ""Mutation"")], by = c(""Mutation""))"
"0","   if(dim(pair_001)[1] > 0){"
"0","   df_CH3_shared_joined <- rbind(df_CH3_shared_joined, pair_001)"
"0","   #shared iSNVs"
"0","   don_rec_shared <- paste0(intersect(theDonor$Mutation, theRecipient$Mutation), collapse=""|"")"
"0","   don_rec_shared_count <- length(intersect(theDonor$Mutation, theRecipient$Mutation))"
"0","   #Only donor isnvs, only recipient (i)snvs"
"0","   don_isnvs <- paste0(setdiff(theDonor$Mutation, theRecipient$Mutation), collapse=""|"")"
"0","   rec_isnvs <- paste0(setdiff(theRecipient$Mutation, theDonor$Mutation), collapse=""|"")"
"0","   fromTo <- paste0(theDonorOId, ""_"", theRecipientOId)"
"0","   fromToSeq <- paste0(donorId, ""_"", recipientId)"
"0","   df_0 <- data.frame(fromTo = fromTo, fromToSeq =  fromToSeq, shared_isnv = don_rec_shared, don_rec_shared_count = don_rec_shared_count, uniq_to_don = don_isnvs, uniq_to_rec = rec_isnvs, stringsAsFactors = F)"
"0","   df_CH3_shared <- rbind(df_CH3_shared, df_0)"
"0","   }else{"
"0","     don_rec_shared <- """""
"0","     don_rec_shared_count <- 0"
"0","     don_isnvs <- paste0(setdiff(theDonor$Mutation, theRecipient$Mutation), collapse=""|"")"
"0","     rec_isnvs <- paste0(setdiff(theRecipient$Mutation, theDonor$Mutation), collapse=""|"")"
"0","     fromTo <- paste0(theDonorOId, ""_"", theRecipientOId)"
"0","     fromToSeq <- paste0(donorId, ""_"", recipientId)"
"0","     df_0 <- data.frame(fromTo = fromTo, fromToSeq =  fromToSeq, shared_isnv = don_rec_shared, don_rec_shared_count = don_rec_shared_count, uniq_to_don = don_isnvs, uniq_to_rec = rec_isnvs, stringsAsFactors = F)"
"0","     df_CH3_shared <- rbind(df_CH3_shared, df_0)"
"0","   }"
"0","}"
"0"," "
"0","write_xlsx(df_CH3_shared_joined, ""df_CH3_shared_joined.xlsx"")"
"0","write_xlsx(df_CH3_shared, ""ch3_shared_isnvs.xlsx"")"
"0","#df_CH3_shared_joined <- read_xlsx(""df_CH3_shared_joined.xlsx"") ## Dataframe of only shared positions between pairs"
"0","#df_CH3_shared <- read_xlsx(""ch3_shared_isnvs.xlsx"") ##"
"0","## add shared"
"0","df_all_ch3_pairs_sd_shared <- inner_join(df_all_ch3_pairs_sd, df_CH3_shared, by = c( ""pairOId"" = ""fromTo""))"

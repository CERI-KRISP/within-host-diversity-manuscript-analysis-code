"0","### Heatmap"
"0","####st_aug pheat"
"0","# create color palet"
"0","col.pal <- brewer.pal(9,""Greens"")"
"0","## Unique variants shared by at least one pair"
"0","df_staug_minor_allele_distn$don_rec_shared <- as.character(df_staug_minor_allele_distn$don_rec_shared)"
"0","donor_recipient_shared_variants <- c()"
"0","for(row in 1:nrow(df_staug_minor_allele_distn)){"
"0","  aa <- strsplit(df_staug_minor_allele_distn[row, ""don_rec_shared""], ""[|]"")"
"0","  #message(aa)"
"0","  donor_recipient_shared_variants <- c(donor_recipient_shared_variants, aa)"
"0","}"
"0","donor_recipient_shared_variants <- unique(unlist(donor_recipient_shared_variants))"
"0","##pairs with common mutations"
"0","df_snvs_isnvs_donor_recipients <- df_snvs_isnvs_purged %>% filter(Sample %in% all_mapped_ch1_outbreak_ids &"
"0","                                                                    Mutation %in% donor_recipient_shared_variants)"
"0","##Annotations"
"0","# Col - start with so I can use it to also order the heatmap cols"
"0","df_snvs_isnvs_donor_recipients_nodups <- df_snvs_isnvs_donor_recipients[, c(""POS"",""Mutation"", ""Protein"", ""Biological Effect"",""IMPACT"")]"
"0","df_snvs_isnvs_donor_recipients_nodups[df_snvs_isnvs_donor_recipients_nodups$`Biological Effect` == ""missense"", ""Biological Effect""] <- ""non-synonymous"""
"0","df_snvs_isnvs_donor_recipients_nodups <- df_snvs_isnvs_donor_recipients_nodups[!duplicated(df_snvs_isnvs_donor_recipients_nodups),]"
"0","df_snvs_isnvs_donor_recipients_nodups <- df_snvs_isnvs_donor_recipients_nodups[order(df_snvs_isnvs_donor_recipients_nodups$POS), ]"
"0","rownames_mutations <- df_snvs_isnvs_donor_recipients_nodups$Mutation"
"0","df_snvs_isnvs_donor_recipients_nodups[, c(""Mutation"",""POS"")] <- list(NULL)"
"0","rownames(df_snvs_isnvs_donor_recipients_nodups) <- rownames_mutations"
"0","df_snvs_isnvs_donor_recipients_nodups <- as.data.frame(df_snvs_isnvs_donor_recipients_nodups)"
"0","# row annotation for shared mutations"
"0","hm_st_aug_ids <- c(""KPCOVID-0016"", ""KPCOVID-0017"", ""KPCOVID-0055"", ""KPCOVID-0056"", ""KPCOVID-0057"", ""KPCOVID-0058"", ""KPCOVID-0066"", ""KPCOVID-0067"", ""KPCOVID-0112"", "
"0","             ""KPCOVID-81"", ""KPCOVID-84"", ""KPCOVID-91"", ""KPCOVID-040-R"", ""KPCOVID-88"", ""KPCOVID-0115"", ""KPCOVID-89"", ""KPCOVID-0021REP"", ""KPCOVID-0113"")"
"0","hm_st_aug_pids <-      c(""P5"", ""P7"", ""P3"", ""P14"", ""HW4"", ""P12"", ""P13"", ""P11"", ""P27"", ""P29"", ""P20"", ""P21"", ""P10"", ""P22"", ""P15"",""P23"", ""X1"", ""P26"")"
"0","st_aug_trans_chains <- c(""C1"", ""C4"", ""C1"", ""C5"",  ""C3"",  ""C2"",  ""C1"",  ""C3"",  ""C1"",  ""C1"",  ""C1"",  ""C1"",  ""C1"",  ""C1"",  ""C3"", ""C4"",  ""C4"", ""C4"")"
"0","df_staug_metadata <- data.frame(hm_st_aug_ids = hm_st_aug_ids, hm_st_aug_pids = hm_st_aug_pids, st_aug_trans_chains = st_aug_trans_chains, stringsAsFactors = F)"
"0","df_staug_metadata <- df_staug_metadata %>% filter(hm_st_aug_ids %in% unique(df_snvs_isnvs_donor_recipients$Sample))"
"0","df_staug_metadata <- df_staug_metadata %>% mutate(st_aug_trans_chains = case_when(st_aug_trans_chains == ""C1"" ~ ""P3_Chain"","
"0","                                                                                  st_aug_trans_chains == ""C3"" ~ ""HW4_Chain"","
"0","                                                                                  st_aug_trans_chains == ""C4"" ~ ""P7_Chain""))"
"0","rownames(df_staug_metadata) <- df_staug_metadata$hm_st_aug_ids"
"0","#df_staug_metadata <- df_staug_metadata[rownames(hm_mat_wide), ]"
"0","df_staug_metadata <- df_staug_metadata[order(df_staug_metadata$st_aug_trans_chains), ]"
"0","## create heatmap main"
"0","hm_mat <- df_snvs_isnvs_donor_recipients[, c(""Sample"", ""AF"",""Mutation"")]"
"0","hm_mat_wide <- data.frame(spread(hm_mat, ""Mutation"", ""AF""), stringsAsFactors = F)"
"0","hm_mat_wide <- hm_mat_wide[, c(""Sample"",rownames_mutations)]"
"0","hm_mat_wide[,2:ncol(hm_mat_wide)] <- sapply(hm_mat_wide[,2:ncol(hm_mat_wide)],as.numeric)"
"0","hm_mat_wide [is.na(hm_mat_wide)] <- 0"
"0","rownames_ <- hm_mat_wide$Sample "
"0","hm_mat_wide$Sample <- NULL"
"0","rownames(hm_mat_wide) <- rownames_"
"0","hm_mat_wide <- hm_mat_wide[order(rownames(df_staug_metadata)), ]"
"0","hm_mat_wide <- as.matrix(hm_mat_wide)"
"0","# Row"
"0","annot_row <- data.frame(Transmission_Chain = df_staug_metadata$st_aug_trans_chains, stringsAsFactors = F)"
"0","colnames(annot_row) <- ""TC"""
"0","rownames(annot_row) <- df_staug_metadata$hm_st_aug_pids"
"0","rownames(hm_mat_wide) <- df_staug_metadata$hm_st_aug_pids"
"0","annot_colors = list(Protein = orfPallet,"
"0","                    ""Mutation Type"" = c(""synonymous""= ""#C77CFF"", ""non-synonymous""=""#7CAE00""),"
"0","                    IMPACT = c(""HIGH""=""#ff3300"", ""MODERATE""=""#ff9900"", ""LOW""=""#6699CC""))"
"0","pheatmap(hm_mat_wide, annotation_col = df_snvs_isnvs_donor_recipients_nodups, "
"0","         annotation_colors = annot_colors,"
"0","         annotation_row = annot_row, color = col.pal,"
"0","         cellwidth = 12, cellheight = 10, scale = ""none"","
"0","         cluster_cols = F, cluster_rows = F) "
